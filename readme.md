#NetworkStorage
Описание программы.

Будет 2 проекта – Клиент и Сервер.

Пользователь создает вручную директорию для обмена (Директория клиента), на сервере автоматически создается директория с именем пользователя, если она не существует (Директория на сервере). Далее пользователь добавляет или удаляет файлы в Директорию клиента и она синхронизируется с Директорией на сервере.
Передача осуществляется по одному файлу небольшого размера.
Пользователь может заходить в свой аккаунт с разных устройств, предварительно создав на всех устройствах Директории клиента и они также синхронизируются с Директорией на сервере.
Несколько пользователей могут одновременно заходить на сервер. Пользователь единовременно может заходить на сервер только с одного устройства (чтобы не получилось, что мы редактируем или удаляем одновременно один и тот же файл).
Клиент может сделать запрос на сервер и использовать методы сервера, сервер не может сделать запрос клиенту и использовать методы клиента.

Авторизации клиента не будет.

Клиент-Серверное взаимодействие

На клиенте метод answerFromServer вызывается раз в 10 секунд. Разные клиенты вызывают этот метод одновременно. Клиент единовременно может вызывать этот метод при входе только с одного устройства, чтобы не получилось, что мы записываем или удаляем один и тот же файл.

В методе answerFromServer клиент получает список файлов из Директории клиента. Далее вызывается метод filesToSyncronized, в котором список файлов из Директории клиента передается на сервер, этот список сервер сравнивает со списком файлов в БД, которые уже есть на сервере для этого клиента. Файлы сравниваются по имени. В результате получим, какие файлы надо добавить или удалить.

Добавление файлов. Сервер определяет, какие файлы надо скачать с клиента и какие передать клиенту, метод filesToSyncronized возвращает объект с четыремя полями: лист строк с названиями файлов, которые нужно передать на сервер, и лист строк с названиями файлов, которые нужно получить с сервера, лист строк с названиями файлов, которые нужно удалить на сервере, и лист строк с названиями файлов, которые нужно удалить у клиента. Этот объект передается клиенту.
Далее клиент каждый файл из списка для передачи на сервер отправляет на сервер с помощью метода сервера receiveFromClient, который получает файлы с клиента и делает запись в БД о файлах, которые хранятся на сервере для данного клиента.
Далее клиент название каждого файла из списка для получения с сервера отправляет на сервер с помощью метода сервера transferToClient, который отправляет файлы на клиент.

Удаление файлов. Сервер определяет, какие файлы надо удалить на сервере и на клиенте.
Внутри метода filesToDeleteFromServerAndClient вызывается метод сервера deleteFromServer, который удаляет файлы и удаляет запись о файле из БД, а также добавляет файл в список удаленных.
Клиент вызывает метод клиента deleteFromClient, который удаляет поочередно файлы из списка файлов для удаления на клиенте из Директории клиента.

Логика добавления/удаления:
1) Если есть новый файл на сервере, сравниваем дату добавления этого файла с датой последней синхронизации клиента. Если дата синхронизации меньше – добавляем файлы клиенту, метод transferToClient. Если дата синхронизации больше – удаляем файл на сервере, метод deletefromServer, добавляем в список удаленных, удаляем из списка файлов на сервере


2) Если файл есть на клиенте и нет на сервере:

А) если файла нет в списке удаленных:
      добавляем его на сервер, метод receiveFromClient, добавляем в список файлов на сервере

Б) если файл есть в списке удаленных:
      Дата удаления после даты последней синхронизации – удаляем с клиента, deleteFromClient
      Дата удаления ранее даты последней синхронизации – добавляем на сервер, receiveFromClient, добавляем в список файлов на сервере, убираем из списка удаленных. Файл ранее был удален и теперь добавлен повторно.

Одному и тому же клиенту запрещено одновременно синхронизироваться с сервером с разных устройств. Для этого в БД есть список синхронизации SyncLock. Если клиент сейчас синхронизируется, значение lock у него равно 1, и мы ждем, пока он закончит синхронизацию. Когда синхронизация заканчивается, то значение lock меняется на 0, и можно начинать синхронизацию с другого устройства.

      Использовала статьи:
      https://www.baeldung.com/servlet-download-file загрузка с сервера на клиент метод transferToClient
      Методы recieveFromClient у сервера и клиента:
      http://spring-projects.ru/guides/uploading-files/#initial
      https://www.baeldung.com/java-feign-file-upload

Запуск программы

На сервере в application-properties добавляем настройки:

pathToDirOnServer=C:/Users/julia/Programming/IdeaProjects/network_storage

Это Директория, где будут храниться файлы сервера. Слеш в конце не ставим. Внутри этой директории автоматически создастся директория с именем клиента, в которой будут храниться файлы.

На клиенте в application-properties добавляем настройки:

server.port=8081

clientName=julia

pathToClientHomeDir=C:/Users/julia/Desktop

idDevice=100

Создаем директорию для хранения файлов клиента C:/Users/julia/Desktop/julia

Сначала запускаем сервер, потом клиент.

Для того, чтобы имитировать ситуацию, когда клиент заходит с разных устройств, в работающей программе меняем настройки в application-properties:

server.port=8082

clientName=julia

pathToClientHomeDir=C:/Users/julia/Desktop/juliaPhone

idDevice=200

Создаем директорию для хранения файлов клиента C:/Users/julia/Desktop/juliaPhone/julia
idDevice должен отличаться от предыдущего

Перезапускаем ClientApplication.
